"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _spinalEnvViewerGraphService = require("spinal-env-viewer-graph-service");

var _spinalModelsBuildingElements = require("spinal-models-building-elements");

var _spinalEnvViewerPluginBimobjectservice = require("spinal-env-viewer-plugin-bimobjectservice");

var _spinalEnvViewerPluginBimobjectservice2 = _interopRequireDefault(_spinalEnvViewerPluginBimobjectservice);

var _constants = require("./constants");

var constants = _interopRequireWildcard(_constants);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const GeographicContext = {
  constants: constants,

  /**
   * Returns the child type of the type given as parameter.
   * @param {string} parentType
   * @return {string} Child type
   */
  getChildType(parentType) {
    let parentTypeIndex = constants.GEOGRAPHIC_TYPES_ORDER.indexOf(parentType);

    if (parentTypeIndex === -1) {
      return "";
    }

    return constants.GEOGRAPHIC_TYPES_ORDER[parentTypeIndex + 1];
  },

  /**
   * It Takes as parameter a context name, returns true if a context with the same name does not exist, else returns false.
   * @param {string} contextName
   * @returns {Boolean}
   */
  createContext(contextName) {
    if (typeof contextName !== "string") {
      throw Error("contextName must be a string");
    }

    const context = _spinalEnvViewerGraphService.SpinalGraphService.getContext(contextName);

    if (typeof context !== "undefined") return false;

    _spinalEnvViewerGraphService.SpinalGraphService.addContext(contextName, constants.CONTEXT_TYPE, new _spinalModelsBuildingElements.AbstractElement(contextName));

    return true;
  },

  /**
   * This method takes as parameters a context (SpinalContext), a parent node (must be a SpinalNode) and a string representing the abstract element type;
   * @param {SpinalContext} context - The Context geographic
   * @param {SpinalNode} node - The parent Node
   * @param {string} elementName - The AbstactElement Name
   * @returns {Boolean}
   */
  addAbstractElement(context, node, elementName) {
    const parentType = node.type.get();
    const childType = this.getChildType(parentType);

    if (!childType) {
      throw Error(`${parentType} is not a valid type in geographical context`);
    }

    const childRelation = constants.MAP_TYPE_RELATION.get(childType);

    const childNode = _spinalEnvViewerGraphService.SpinalGraphService.createNode({
      name: elementName,
      type: childType
    }, new _spinalModelsBuildingElements.AbstractElement(elementName));
    _spinalEnvViewerGraphService.SpinalGraphService.addChildInContext(node.id.get(), childNode, context.id.get(), childRelation, _spinalEnvViewerGraphService.SPINAL_RELATION_TYPE);
    return true;
  },

  /**
   * @param {SpinalContext} context - The Context geographic
   * @param {SpinalNode} node - The parent Node
   * @param {string} buildingName - Building Name
   */
  addBuilding(context, node, buildingName) {
    return GeographicContext.addAbstractElement(context, node, buildingName);
  },

  /**
   * @param {SpinalContext} context - The Context geographic
   * @param {SpinalNode} node - The parent Node
   * @param {string} floorName - the floor Name
   */
  addFloor(context, node, floorName) {
    return GeographicContext.addAbstractElement(context, node, floorName);
  },

  /**
   * @param {SpinalContext} context - The Context geographic
   * @param {SpinalNode} node - The parent Node
   * @param {string} zoneName - Zone name
   */
  addZone(context, node, zoneName) {
    return GeographicContext.addAbstractElement(context, node, zoneName);
  },

  /**
   * @param {SpinalContext} context - The Context geographic
   * @param {SpinalNode} node - The parent Node
   * @param {string} roomName - Room Name
   */
  addRoom(context, node, roomName) {
    return GeographicContext.addAbstractElement(context, node, roomName);
  },

  /**
   * it uses bimObject service to add all dbIds passed as parameters.
   * the parameter dbIds can be a simple dbIds or a list of dbIds.
   * @param {SpinalContext} context - The Context geographic
   * @param {SpinalNode} node - The parent Node
   * @param {Number | Array<Number>} dbIds - Can be
   */
  addBimElement(context, node, dbIds) {
    if (!Array.isArray(dbIds)) dbIds = [dbIds];

    // le bimObjectService
    let c = _spinalEnvViewerGraphService.SpinalGraphService.getRealNode(context.id.get());
    let n = _spinalEnvViewerGraphService.SpinalGraphService.getRealNode(node.id.get());

    dbIds.forEach(element => {
      _spinalEnvViewerPluginBimobjectservice2.default.addBIMObject(c, n, element, element);
    });
  }
};

exports.default = GeographicContext;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJjb25zdGFudHMiLCJHZW9ncmFwaGljQ29udGV4dCIsImdldENoaWxkVHlwZSIsInBhcmVudFR5cGUiLCJwYXJlbnRUeXBlSW5kZXgiLCJHRU9HUkFQSElDX1RZUEVTX09SREVSIiwiaW5kZXhPZiIsImNyZWF0ZUNvbnRleHQiLCJjb250ZXh0TmFtZSIsIkVycm9yIiwiY29udGV4dCIsIlNwaW5hbEdyYXBoU2VydmljZSIsImdldENvbnRleHQiLCJhZGRDb250ZXh0IiwiQ09OVEVYVF9UWVBFIiwiQWJzdHJhY3RFbGVtZW50IiwiYWRkQWJzdHJhY3RFbGVtZW50Iiwibm9kZSIsImVsZW1lbnROYW1lIiwidHlwZSIsImdldCIsImNoaWxkVHlwZSIsImNoaWxkUmVsYXRpb24iLCJNQVBfVFlQRV9SRUxBVElPTiIsImNoaWxkTm9kZSIsImNyZWF0ZU5vZGUiLCJuYW1lIiwiYWRkQ2hpbGRJbkNvbnRleHQiLCJpZCIsIlNQSU5BTF9SRUxBVElPTl9UWVBFIiwiYWRkQnVpbGRpbmciLCJidWlsZGluZ05hbWUiLCJhZGRGbG9vciIsImZsb29yTmFtZSIsImFkZFpvbmUiLCJ6b25lTmFtZSIsImFkZFJvb20iLCJyb29tTmFtZSIsImFkZEJpbUVsZW1lbnQiLCJkYklkcyIsIkFycmF5IiwiaXNBcnJheSIsImMiLCJnZXRSZWFsTm9kZSIsIm4iLCJmb3JFYWNoIiwiZWxlbWVudCIsImJpbW9ialNlcnZpY2UiLCJhZGRCSU1PYmplY3QiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBOztBQUlBOztBQUdBOzs7O0FBRUE7O0lBQVlBLFM7Ozs7OztBQUVaLE1BQU1DLG9CQUFvQjtBQUN4QkQsYUFBV0EsU0FEYTs7QUFHeEI7Ozs7O0FBS0FFLGVBQWFDLFVBQWIsRUFBeUI7QUFDdkIsUUFBSUMsa0JBQWtCSixVQUFVSyxzQkFBVixDQUFpQ0MsT0FBakMsQ0FBeUNILFVBQXpDLENBQXRCOztBQUVBLFFBQUlDLG9CQUFvQixDQUFD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WCxFQUEvQixDQUFSO0FBQ0EsUUFBSXdCLElBQUlqQyxnREFBbUJnQyxXQUFuQixDQUErQjFCLEtBQUtXLEVBQUwsQ0FBUVIsR0FBUixFQUEvQixDQUFSOztBQUVBbUIsVUFBTU0sT0FBTixDQUFjQyxXQUFXO0FBQ3ZCQyxzREFBY0MsWUFBZCxDQUEyQk4sQ0FBM0IsRUFBOEJFLENBQTlCLEVBQWlDRSxPQUFqQyxFQUEwQ0EsT0FBMUM7QUFDRCxLQUZEO0FBR0Q7QUFoSXVCLENBQTFCOztrQkFtSWU3QyxpQiIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIFNQSU5BTF9SRUxBVElPTl9UWVBFLFxuICBTcGluYWxHcmFwaFNlcnZpY2Vcbn0gZnJvbSBcInNwaW5hbC1lbnYtdmlld2VyLWdyYXBoLXNlcnZpY2VcIjtcbmltcG9ydCB7XG4gIEFic3RyYWN0RWxlbWVudFxufSBmcm9tIFwic3BpbmFsLW1vZGVscy1idWlsZGluZy1lbGVtZW50c1wiO1xuaW1wb3J0IGJpbW9ialNlcnZpY2UgZnJvbSAnc3BpbmFsLWVudi12aWV3ZXItcGx1Z2luLWJpbW9iamVjdHNlcnZpY2UnO1xuXG5pbXBvcnQgKiBhcyBjb25zdGFudHMgZnJvbSBcIi4vY29uc3RhbnRzXCI7XG5cbmNvbnN0IEdlb2dyYXBoaWNDb250ZXh0ID0ge1xuICBjb25zdGFudHM6IGNvbnN0YW50cyxcblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgY2hpbGQgdHlwZSBvZiB0aGUgdHlwZSBnaXZlbiBhcyBwYXJhbWV0ZXIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwYXJlbnRUeXBlXG4gICAqIEByZXR1cm4ge3N0cmluZ30gQ2hpbGQgdHlwZVxuICAgKi9cbiAgZ2V0Q2hpbGRUeXBlKHBhcmVudFR5cGUpIHtcbiAgICBsZXQgcGFyZW50VHlwZUluZGV4ID0gY29uc3RhbnRzLkdFT0dSQVBISUNfVFlQRVNfT1JERVIuaW5kZXhPZihwYXJlbnRUeXBlKTtcblxuICAgIGlmIChwYXJlbnRUeXBlSW5kZXggPT09IC0xKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG5cbiAgICByZXR1cm4gY29uc3RhbnRzLkdFT0dSQVBISUNfVFlQRVNfT1JERVJbcGFyZW50VHlwZUluZGV4ICsgMV07XG4gIH0sXG5cbiAgLyoqXG4gICAqIEl0IFRha2VzIGFzIHBhcmFtZXRlciBhIGNvbnRleHQgbmFtZSwgcmV0dXJucyB0cnVlIGlmIGEgY29udGV4dCB3aXRoIHRoZSBzYW1lIG5hbWUgZG9lcyBub3QgZXhpc3QsIGVsc2UgcmV0dXJucyBmYWxzZS5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGNvbnRleHROYW1lXG4gICAqIEByZXR1cm5zIHtCb29sZWFufVxuICAgKi9cbiAgY3JlYXRlQ29udGV4dChjb250ZXh0TmFtZSkge1xuICAgIGlmICh0eXBlb2YgY29udGV4dE5hbWUgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICBcImNvbnRleHROYW1lIG11c3QgYmUgYSBzdHJpbmdcIik7XG4gICAgfVxuXG4gICAgY29uc3QgY29udGV4dCA9IFNwaW5hbEdyYXBoU2VydmljZS5nZXRDb250ZXh0KGNvbnRleHROYW1lKTtcblxuICAgIGlmICh0eXBlb2YgY29udGV4dCAhPT0gXCJ1bmRlZmluZWRcIikgcmV0dXJuIGZhbHNlO1xuXG5cbiAgICBTcGluYWxHcmFwaFNlcnZpY2UuYWRkQ29udGV4dChjb250ZXh0TmFtZSxcbiAgICAgIGNvbnN0YW50cy5DT05URVhUX1RZUEUsXG4gICAgICBuZXcgQWJzdHJhY3RFbGVtZW50KGNvbnRleHROYW1lKSk7XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcblxuICAvKipcbiAgICogVGhpcyBtZXRob2QgdGFrZXMgYXMgcGFyYW1ldGVycyBhIGNvbnRleHQgKFNwaW5hbENvbnRleHQpLCBhIHBhcmVudCBub2RlIChtdXN0IGJlIGEgU3BpbmFsTm9kZSkgYW5kIGEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgYWJzdHJhY3QgZWxlbWVudCB0eXBlO1xuICAgKiBAcGFyYW0ge1NwaW5hbENvbnRleHR9IGNvbnRleHQgLSBUaGUgQ29udGV4dCBnZW9ncmFwaGljXG4gICAqIEBwYXJhbSB7U3BpbmFsTm9kZX0gbm9kZSAtIFRoZSBwYXJlbnQgTm9kZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudE5hbWUgLSBUaGUgQWJzdGFjdEVsZW1lbnQgTmFtZVxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAgICovXG4gIGFkZEFic3RyYWN0RWxlbWVudChjb250ZXh0LCBub2RlLCBlbGVtZW50TmFtZSkge1xuICAgIGNvbnN0IHBhcmVudFR5cGUgPSBub2RlLnR5cGUuZ2V0KCk7XG4gICAgY29uc3QgY2hpbGRUeXBlID0gdGhpcy5nZXRDaGlsZFR5cGUocGFyZW50VHlwZSk7XG5cbiAgICBpZiAoIWNoaWxkVHlwZSkge1xuICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgIGAke3BhcmVudFR5cGV9IGlzIG5vdCBhIHZhbGlkIHR5cGUgaW4gZ2VvZ3JhcGhpY2FsIGNvbnRleHRgXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IGNoaWxkUmVsYXRpb24gPSBjb25zdGFudHMuTUFQX1RZUEVfUkVMQVRJT04uZ2V0KGNoaWxkVHlwZSk7XG5cbiAgICBjb25zdCBjaGlsZE5vZGUgPSBTcGluYWxHcmFwaFNlcnZpY2UuY3JlYXRlTm9kZSh7XG4gICAgICAgIG5hbWU6IGVsZW1lbnROYW1lLFxuICAgICAgICB0eXBlOiBjaGlsZFR5cGVcbiAgICAgIH0sXG4gICAgICBuZXcgQWJzdHJhY3RFbGVtZW50KGVsZW1lbnROYW1lKVxuICAgICk7XG4gICAgU3BpbmFsR3JhcGhTZXJ2aWNlLmFkZENoaWxkSW5Db250ZXh0KG5vZGUuaWQuZ2V0KCksIGNoaWxkTm9kZSwgY29udGV4dC5pZFxuICAgICAgLmdldCgpLCBjaGlsZFJlbGF0aW9uLCBTUElOQUxfUkVMQVRJT05fVFlQRSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7U3BpbmFsQ29udGV4dH0gY29udGV4dCAtIFRoZSBDb250ZXh0IGdlb2dyYXBoaWNcbiAgICogQHBhcmFtIHtTcGluYWxOb2RlfSBub2RlIC0gVGhlIHBhcmVudCBOb2RlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidWlsZGluZ05hbWUgLSBCdWlsZGluZyBOYW1lXG4gICAqL1xuICBhZGRCdWlsZGluZyhjb250ZXh0LCBub2RlLCBidWlsZGluZ05hbWUpIHtcbiAgICByZXR1cm4gR2VvZ3JhcGhpY0NvbnRleHQuYWRkQWJzdHJhY3RFbGVtZW50KGNvbnRleHQsIG5vZGUsIGJ1aWxkaW5nTmFtZSk7XG4gIH0sXG5cblxuICAvKipcbiAgICogQHBhcmFtIHtTcGluYWxDb250ZXh0fSBjb250ZXh0IC0gVGhlIENvbnRleHQgZ2VvZ3JhcGhpY1xuICAgKiBAcGFyYW0ge1NwaW5hbE5vZGV9IG5vZGUgLSBUaGUgcGFyZW50IE5vZGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IGZsb29yTmFtZSAtIHRoZSBmbG9vciBOYW1lXG4gICAqL1xuICBhZGRGbG9vcihjb250ZXh0LCBub2RlLCBmbG9vck5hbWUpIHtcbiAgICByZXR1cm4gR2VvZ3JhcGhpY0NvbnRleHQuYWRkQWJzdHJhY3RFbGVtZW50KGNvbnRleHQsIG5vZGUsIGZsb29yTmFtZSk7XG4gIH0sXG5cblxuICAvKipcbiAgICogQHBhcmFtIHtTcGluYWxDb250ZXh0fSBjb250ZXh0IC0gVGhlIENvbnRleHQgZ2VvZ3JhcGhpY1xuICAgKiBAcGFyYW0ge1NwaW5hbE5vZGV9IG5vZGUgLSBUaGUgcGFyZW50IE5vZGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IHpvbmVOYW1lIC0gWm9uZSBuYW1lXG4gICAqL1xuICBhZGRab25lKGNvbnRleHQsIG5vZGUsIHpvbmVOYW1lKSB7XG4gICAgcmV0dXJuIEdlb2dyYXBoaWNDb250ZXh0LmFkZEFic3RyYWN0RWxlbWVudChjb250ZXh0LCBub2RlLCB6b25lTmFtZSk7XG4gIH0sXG5cblxuICAvKipcbiAgICogQHBhcmFtIHtTcGluYWxDb250ZXh0fSBjb250ZXh0IC0gVGhlIENvbnRleHQgZ2VvZ3JhcGhpY1xuICAgKiBAcGFyYW0ge1NwaW5hbE5vZGV9IG5vZGUgLSBUaGUgcGFyZW50IE5vZGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IHJvb21OYW1lIC0gUm9vbSBOYW1lXG4gICAqL1xuICBhZGRSb29tKGNvbnRleHQsIG5vZGUsIHJvb21OYW1lKSB7XG4gICAgcmV0dXJuIEdlb2dyYXBoaWNDb250ZXh0LmFkZEFic3RyYWN0RWxlbWVudChjb250ZXh0LCBub2RlLCByb29tTmFtZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIGl0IHVzZXMgYmltT2JqZWN0IHNlcnZpY2UgdG8gYWRkIGFsbCBkYklkcyBwYXNzZWQgYXMgcGFyYW1ldGVycy5cbiAgICogdGhlIHBhcmFtZXRlciBkYklkcyBjYW4gYmUgYSBzaW1wbGUgZGJJZHMgb3IgYSBsaXN0IG9mIGRiSWRzLlxuICAgKiBAcGFyYW0ge1NwaW5hbENvbnRleHR9IGNvbnRleHQgLSBUaGUgQ29udGV4dCBnZW9ncmFwaGljXG4gICAqIEBwYXJhbSB7U3BpbmFsTm9kZX0gbm9kZSAtIFRoZSBwYXJlbnQgTm9kZVxuICAgKiBAcGFyYW0ge051bWJlciB8IEFycmF5PE51bWJlcj59IGRiSWRzIC0gQ2FuIGJlXG4gICAqL1xuICBhZGRCaW1FbGVtZW50KGNvbnRleHQsIG5vZGUsIGRiSWRzKSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGRiSWRzKSkgZGJJZHMgPSBbZGJJZHNdO1xuXG5cbiAgICAvLyBsZSBiaW1PYmplY3RTZXJ2aWNlXG4gICAgbGV0IGMgPSBTcGluYWxHcmFwaFNlcnZpY2UuZ2V0UmVhbE5vZGUoY29udGV4dC5pZC5nZXQoKSk7XG4gICAgbGV0IG4gPSBTcGluYWxHcmFwaFNlcnZpY2UuZ2V0UmVhbE5vZGUobm9kZS5pZC5nZXQoKSk7XG5cbiAgICBkYklkcy5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgYmltb2JqU2VydmljZS5hZGRCSU1PYmplY3QoYywgbiwgZWxlbWVudCwgZWxlbWVudCk7XG4gICAgfSk7XG4gIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IEdlb2dyYXBoaWNDb250ZXh0OyJdfQ==